<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="helpns">
	<!-- 1:1문의 입력 -->
	<insert id="insert" parameterType="help">
		insert into help values
		(help_seq.nextval,#{id},#{h_title},#{h_content},#{h_fileName},sysdate,'n')
	</insert>

	<!-- 회원별 문의 총 갯수 -->
	<select id="getTotal" resultType="integer" parameterType="help">
		select count(*) from help
		<where>
			id=#{id}
			<if test=" keyword != null and keyword !=''">
				and
				<if test="search=='subcon'">
					( h_title like '%' || #{keyword} || '%' or
					h_content
					like '%'
					||
					#{keyword} || '%')
				</if>

				<if test="search!='subcon'">
					${search} like '%' || #{keyword} || '%'
				</if>
			</if>
		</where>

	</select>

	<!-- 회원별 문의 리스트 -->
	<select id="list" parameterType="help" resultType="help">
		select * from
		(select rowNum rn, a.* from(
		select * from help
		<where>
			<if test=" keyword != null and keyword !=''">
				<if test="search=='subcon'">
					h_title like '%' || #{keyword} || '%' or
					h_content like
					'%'
					|| #{keyword} || '%'
				</if>

				<if test="search!='subcon'">
					${search} like '%' || #{keyword} || '%'
				</if>
			</if>
		</where>
		order by hno desc )a)
		where rn
		between #{startRow} and #{endRow} and
		id=#{id}
	</select>
	
	<select id="select" parameterType="integer" resultType="help">
	   select * from help where hno=#{hno}
	</select>
	
	<update id="update" parameterType="help">
	update help set h_title=#{h_title}, h_content=#{h_content}, h_fileName=#{h_fileName} where hno=#{hno}
	</update>
</mapper>